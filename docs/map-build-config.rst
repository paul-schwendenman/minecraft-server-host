=============================
Minecraft Map Configuration
=============================

Each Minecraft world contains a mapping configuration file that defines how
static maps are generated by **uNmINeD** through the ``rebuild-map.sh`` script.

This file controls render settings, dimensions, and optional focused areas
with additional zoom levels.

It is located at:

::

   /srv/minecraft-server/<world>/map-config.yml


Overview
========

``map-config.yml`` allows per-world customization of rendering behavior. It
supports:

- Global defaults for all maps
- Multiple map definitions (e.g., overworld, nether, caves)
- Optional “ranges” for focused high-zoom rendering areas

Example Configuration
=====================

.. code-block:: yaml

   defaults:
     zoomout: 2
     zoomin: 1
     imageformat: jpeg
     chunkprocessors: 4

   maps:
     - name: overworld
       dimension: overworld
       output_subdir: overworld
       options:
         shadows: 3d
       ranges:
         - name: spawn_area
           center: [560, 160]
           radius: 2048
           zoomout: 4
           zoomin: 2

     - name: nether
       dimension: nether
       output_subdir: nether
       options:
         topY: 68
         shadows: 2d
         night: false

     - name: caves
       dimension: overworld
       output_subdir: caves
       options:
         topY: 64
         bottomY: -64
         gndxray: true
         shadows: false


File Structure
==============

::

   /srv/minecraft-server/world1/
   ├── level.dat
   ├── region/
   ├── map-config.yml
   └── maps/
       ├── overworld/
       │   ├── manifest.json
       │   └── preview.png
       ├── nether/
       └── caves/


Sections
========

Defaults
--------

Global settings applied to all maps unless overridden in a specific map entry.

=================  ======  ================================================
Key                Type    Description
=================  ======  ================================================
``zoomout``        int     Default zoom-out levels (typical: ``2``)
``zoomin``         int     Default zoom-in levels (typical: ``1``)
``imageformat``    str     Output format (``jpeg``, ``png``, ``webp``)
``chunkprocessors`` int    Number of chunks processed concurrently
=================  ======  ================================================


Maps
----

Each entry in the ``maps`` array defines one rendered map for the world.
Each map produces its own output directory under
``/srv/minecraft-server/maps/<world>/``.

Required keys:

=================  ======  ================================================
Key                Type    Description
=================  ======  ================================================
``name``           str     Logical name for the map
``dimension``      str     One of ``overworld``, ``nether``, ``end``
``output_subdir``  str     Output folder name (defaults to ``name``)
=================  ======  ================================================

Optional keys:

=================  ======  ================================================
Key                Type    Description
=================  ======  ================================================
``zoomout`` / ``zoomin`` int  Override default zoom levels
``options``        obj     Extra options for ``unmined-cli``
``ranges``         list    Focused render regions (see below)
=================  ======  ================================================


Options
-------

Additional settings mapped directly to ``unmined-cli`` arguments.

=================  ======  ================================================
Key                Type    Description
=================  ======  ================================================
``topY``           int     Highest Y coordinate to render
``bottomY``        int     Lowest Y coordinate to render
``gndxray``        bool    Enable underground x-ray mode
``shadows``        str/bool Shadow mode (``false``, ``true``, ``2d``, ``3d``, ``3do``)
``night``          bool    Render in night mode
``players``        bool    Include player markers
=================  ======  ================================================


Ranges
------

Ranges define specific focused render passes for areas of interest.
Useful for spawn regions, hubs, or bases.

=================  ======  ================================================
Key                Type    Description
=================  ======  ================================================
``name``           str     Name of the region
``center``         [x, z]  Center coordinates in blocks
``radius``         int     Radius around center in blocks
``zoomout`` / ``zoomin`` int Override zoom levels for this range
=================  ======  ================================================

Example:

.. code-block:: yaml

   ranges:
     - name: spawn_area
       center: [560, 160]
       radius: 2048
       zoomout: 4
       zoomin: 2


Render Workflow
===============

+-------------------------+---------------------------------------------+
| **Stage**               | **Script**                                  |
+=========================+=============================================+
| Render maps and ranges  | ``rebuild-map.sh`` reads ``map-config.yml`` |
|                         | and updates per-map manifests.              |
+-------------------------+---------------------------------------------+
| Generate previews &     | ``build-map-manifests.sh`` creates          |
| aggregate metadata      | per-world and global manifests.             |
+-------------------------+---------------------------------------------+
| Serve static content    | Caddy / S3 / CloudFront serve               |
|                         | files under ``/srv/minecraft-server/maps/`` |
+-------------------------+---------------------------------------------+


Editing Tips
============

- Keep ``radius`` and zoom levels small to control output size.
- You can add or remove maps freely; scripts detect them automatically.
- To force a re-render, delete the map’s ``manifest.json`` or run
  ``rebuild-map.sh --force``.
- Use different zoom levels per map to balance quality vs. disk usage.


``map-config.yml`` acts as the single source of truth for how world maps
are rendered, optimized, and served.
